<div ng-class="{drop: navclass}" ng-animate="" id="sub-navbar" class="sub-navbar">
<!-- ADVANCED SEARCH FILTERS -->
  <div class="sub-navbar-injection">
    <div class="search-term">
      {{location.lastSelected[0]}}
    </div>
    <div ng-repeat="(key, filters) in config.advancedSchoolFilters" style="float: left;">
      <select ng-change="updateSchools()" ng-model="homeFilters[key]" ng-options="filter.label for filter in filters.options">
        <option value="">{{filters.defaultText}}</option>
      </select>
    </div>
    <div ng-repeat="(key, filters) in config.advancedHomeFilters" style="float: left;">
      <select ng-change="updateHomes()" ng-model="homeFilters[key]" ng-options="filter.label for filter in filters.options">
        <option value="">{{filters.defaultText}}</option>
      </select>
    </div>
  </div>
</div>
<section class="container-flex">
  <div class="col col-75" cg-busy="scorePromise">
    <div class="map">
      <div ng-if="map.polys.length > 0">
        <button class="btn btn-danger" ng-click="clearPolygons()">Clear</button>
        <button class="btn btn-success" ng-click="applyPolygons()">Apply</button>
      </div>
      <ui-gmap-google-map center="map.center" zoom="map.zoom" bounds="map.bounds" draggable="true">
        <ui-gmap-map-control template="draw.tpl.html" position="top-right" index="1" controller="mapWidgetCtrl"></ui-gmap-map-control>
        <ui-gmap-free-draw-polygons polygons='map.polys' draw='map.draw'></ui-gmap-free-draw-polygons>
        <ui-gmap-polygon path="polyline.path" clickable='true' fill="{color: '#002e48', opacity: polyline.selected ? 1 : 0.0 }" ng-if="polyline.selected" ng-repeat="polyline in map.polylines"></ui-gmap-polygon>
        <ui-gmap-markers models="map.schools" coords="'coordinates'" idKey="'_id'" click="'onClicked'"></ui-gmap-markers>
        <ui-gmap-window coords="schoolWindow.coordinates" idKey="schoolWindow._id" show="schoolWindow.showWindow" closeClick="schoolWindow.closeClick" isIconVisibleOnClick="false">
            <p>This is an info window at {{ schoolWindow.coordinates.latitude | number:4 }}, {{ schoolWindow.coordinates.longitude | number:4 }}!</p>
        </ui-gmap-window>
        <ui-gmap-markers models="map.homes" coords="'coordinates'" idKey="'_id'" click="'onClicked'" icon="'icon'">
        </ui-gmap-markers>
        <ui-gmap-window coords="homeWindow.coordinates" idKey="homeWindow._id" show="homeWindow.showWindow" closeClick="homeWindow.closeClick" isIconVisibleOnClick="false">
            <p>This is an info window at {{ homeWindow.coordinates.latitude | number:4 }}, {{ homeWindow.coordinates.longitude | number:4 }}!</p>
        </ui-gmap-window>
      </ui-gmap-google-map>
    </div>
    <table class="table table-hover">
      <thead>
        <tr>
          <th>Rank</th>
          <th>School</th>
          <th>Location</th>
          <th>Score</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="school in map.schools | orderBy:'score.school' | limitTo: 5" ng-if="map.schools.length">
          <td>{{$index + 1}}</td>
          <td><a ng-click="setSchool(school)">{{school.sch_name | titleCase}}</a</td>
          <td><reverse-geocode lat="{{school.coordinates.latitude}}" lng="{{school.coordinates.longitude}}"></reverse-geocode></td>
          <td class="tableScore">{{school.score.realEstate / school.score.school}}</td>
        </tr>
      </tbody>
    </table>
    <div ng-if="!map.schools.length">No Schools Found</div>
  </div>

  <section class="col col-25" cg-busy="homePromise">
    <div class="homeList">
      <span class="homesHeader">{{map.homes.length}} Homes</span>
      <result ng-repeat="home in map.homes | orderBy: home.listing.listingdate[0]" home="home"></result>
      <div ng-if="map.homes.length === 0">
        No Homes Found
      </div>
    </div>

    <div class="agentList">
      Sponsored Agents
    </div>
    <div class="adSpace1">
      Sponsored Ad Space
    </div>
  </section>
</section>