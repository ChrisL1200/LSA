<section class="container-flex">
  <div class="col col-75" cg-busy="scorePromise">
    <div class="map">
      <div ng-if="map.polys.length > 0">
        <button class="btn btn-danger" ng-click="clearPolygons()">Clear</button>
        <button class="btn btn-success" ng-click="applyPolygons()">Apply</button>
      </div>
      <ui-gmap-google-map center="map.center" zoom="map.zoom" bounds="map.bounds" draggable="true">
        <ui-gmap-map-control template="draw.tpl.html" position="top-right" index="1" controller="mapWidgetCtrl"></ui-gmap-map-control>
        <ui-gmap-free-draw-polygons polygons='map.polys' draw='map.draw'></ui-gmap-free-draw-polygons>
        <ui-gmap-polygon path="polyline.path" clickable='true' fill="{color: '#002e48', opacity: polyline.selected ? 0.4 : 0.0 }" ng-if="map.schools.length < 10" ng-repeat="polyline in map.polylines"></ui-gmap-polygon>
        <ui-gmap-markers models="map.schools" coords="'coordinates'" idKey="'_id'" click="'onClicked'"></ui-gmap-markers>
        <ui-gmap-window coords="schoolWindow.coordinates" idKey="schoolWindow._id" show="schoolWindow.showWindow" closeClick="schoolWindow.closeClick" isIconVisibleOnClick="false">
            <p>This is an info window at {{ schoolWindow.coordinates.latitude | number:4 }}, {{ schoolWindow.coordinates.longitude | number:4 }}!</p>
        </ui-gmap-window>
        <ui-gmap-markers models="map.homes" coords="'coordinates'" idKey="'_id'" click="'onClicked'" icon="'icon'">
        </ui-gmap-markers>
        <ui-gmap-window coords="homeWindow.coordinates" idKey="homeWindow._id" show="homeWindow.showWindow" closeClick="homeWindow.closeClick" isIconVisibleOnClick="false">
            <p>This is an info window at {{ homeWindow.coordinates.latitude | number:4 }}, {{ homeWindow.coordinates.longitude | number:4 }}!</p>
        </ui-gmap-window>
      </ui-gmap-google-map>
    </div>
    <table class="table table-hover">
      <thead>
        <tr>
          <th>Rank</th>
          <th>School</th>
          <th>Location</th>
          <th>Score</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="school in map.schools | orderBy:'score' | limitTo: 5" ng-if="map.schools.length">
          <td>{{$index + 1}}</td>
          <td><a ng-click="getHomes(school)">{{school.sch_name | titleCase}}</a</td>
          <td><reverse-geocode lat="{{school.coordinates.latitude}}" lng="{{school.coordinates.longitude}}"></reverse-geocode></td>
          <td class="tableScore">{{school.score}} <a ng-if="selectedSchool._id === school._id" ng-click="unselectSchool()">Unselect</a></td>
        </tr>
      </tbody>
    </table>
    <div ng-if="!map.schools.length">No Schools Found</div>
  </div>

  <section class="col col-25" cg-busy="homePromise">
    <div class="homeList">
      <h3>Homes</h3>
      <div class="row school-result media" ng-repeat="home in map.homes" ng-if="map.homes.length > 0">
          <a class="media-left" ng-href="listing/{{home._id}}">
            <img ng-src="/api/images?url={{home.listing.photos[0].photo[0].storedId}}" style="height:64px;width:64px">
          </a>
          <div class="media-body">
            <h4 class="media-heading">House heading</h4>
              <div>{{home.listing.address[0].fullstreetaddress[0]}}</div>
              <div>{{home.listing.address[0].city[0]}}, {{home.listing.address[0].stateorprovince[0]}}</div>
          </div>
        </div>
        <div>{{home.listing.address[0].fullstreetaddress[0]}}</div>
        <div>{{home.listing.address[0].city[0]}}, {{home.listing.address[0].stateorprovince[0]}}</div>
        <div ng-if="map.homes.length === 0">
          No Homes Found
        </div>
    </div>

    <div class="agentList">
      Sponsored Agents
    </div>
    <div class="adSpace1">
      Sponsored Ad Space
    </div>
  </section>
</section>